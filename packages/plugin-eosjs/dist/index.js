'use strict';var _promise=require('babel-runtime/core-js/promise'),_promise2=_interopRequireDefault(_promise),_assign=require('babel-runtime/core-js/object/assign'),_assign2=_interopRequireDefault(_assign),_asyncToGenerator2=require('babel-runtime/helpers/asyncToGenerator'),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_scatterjsCore=require('scatterjs-core');function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}const proxy=(a,b)=>new Proxy(a,b);class EOS extends _scatterjsCore.Plugin{constructor(){super(_scatterjsCore.Blockchains.EOS,_scatterjsCore.PluginTypes.BLOCKCHAIN_SUPPORT)}signatureProvider(...a){const b=a[0];return(a,c,d={})=>{if(a=_scatterjsCore.Network.fromJson(a),!a.isValid())throw Error.noNetwork();const e=`${a.protocol}://${a.hostport()}`,f=a.hasOwnProperty('chainId')&&a.chainId.length?a.chainId:d.chainId;return proxy(c({httpEndpoint:e,chainId:f}),{get(g,h){let i=null;return(...g)=>{if(g.find(a=>a.hasOwnProperty('keyProvider')))throw Error.usedKeyProvider();const j=(()=>{var c=(0,_asyncToGenerator3.default)(function*(c){b();const d=g.find(function(a){return a.hasOwnProperty('requiredFields')})||{requiredFields:{}},e=(0,_assign2.default)(c,{blockchain:_scatterjsCore.Blockchains.EOS,network:a,requiredFields:d.requiredFields}),f=yield _scatterjsCore.SocketService.sendApiRequest({type:'requestSignature',payload:e});if(!f)return null;if(f.hasOwnProperty('signatures')){i=f.returnedFields;let a=g.find(function(a){return a.hasOwnProperty('signProvider')});return a&&f.signatures.push(a.signProvider(c.buf,c.sign)),f.signatures}return f});return function(){return c.apply(this,arguments)}})();return new _promise2.default((a,b)=>{c((0,_assign2.default)(d,{httpEndpoint:e,signProvider:j,chainId:f}))[h](...g).then(b=>{if(!b.hasOwnProperty('fc'))return b=(0,_assign2.default)(b,{returnedFields:i}),void a(b);const c=proxy(b,{get(a,b){return'then'===b?a[b]:(...c)=>new _promise2.default((()=>{var d=(0,_asyncToGenerator3.default)(function*(d,e){a[b](...c).then(function(a){d((0,_assign2.default)(a,{returnedFields:i}))}).catch(e)});return function(){return d.apply(this,arguments)}})())}});a(c)}).catch(a=>b(a))})}}})}}}module.exports=EOS;